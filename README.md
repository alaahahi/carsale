# Car Management Multi-Tenant System

نظام إدارة السيارات متعدد المستأجرين مبني على Laravel مع دعم قاعدة بيانات منفصلة لكل مستأجر.

## المميزات

- **Multi-Tenancy**: كل مستأجر له قاعدة بيانات منفصلة
- **Domain-based Tenancy**: تحديد المستأجر بناءً على النطاق
- **Central Admin Panel**: لوحة تحكم مركزية لإدارة المستأجرين
- **Tenant Management**: إدارة شاملة للمستأجرين والاشتراكات
- **Data Isolation**: عزل كامل للبيانات بين المستأجرين

## التثبيت

### 1. تثبيت المتطلبات

```bash
composer install
npm install
```

### 2. إعداد البيئة

```bash
cp .env.example .env
php artisan key:generate
```

### 3. إعداد قاعدة البيانات المركزية

قم بتعديل ملف `.env`:

```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=car_management_central
DB_USERNAME=root
DB_PASSWORD=your_password
```

### 4. تشغيل Migrations

```bash
php artisan migrate
```

### 5. إعداد النطاقات المحلية

أضف هذه الأسطر إلى ملف `hosts`:

```
127.0.0.1 car-management.local
127.0.0.1 admin.car-management.local
127.0.0.1 tenant1.car-management.local
127.0.0.1 tenant2.car-management.local
```

## الاستخدام

### إنشاء مستأجر جديد

1. انتقل إلى لوحة التحكم المركزية: `http://admin.car-management.local/admin/tenants`
2. انقر على "إنشاء مستأجر جديد"
3. أدخل البيانات المطلوبة:
   - اسم المستأجر
   - النطاق (مثل: tenant1.car-management.local)
   - البريد الإلكتروني
   - خطة الاشتراك
   - تاريخ انتهاء الاشتراك

### الوصول للمستأجر

بعد إنشاء المستأجر، يمكن الوصول إليه عبر النطاق المحدد:
`http://tenant1.car-management.local`

### إدارة المستأجرين

- **تفعيل/تعطيل**: يمكن تفعيل أو تعطيل المستأجرين
- **تحديث البيانات**: تعديل معلومات المستأجر
- **حذف المستأجر**: حذف المستأجر وقاعدة البيانات الخاصة به

## البنية التقنية

### قاعدة البيانات المركزية

تحتوي على:
- جدول `tenants`: معلومات المستأجرين
- جدول `domains`: النطاقات المرتبطة بالمستأجرين
- جداول النظام العامة

### قواعد بيانات المستأجرين

كل مستأجر له قاعدة بيانات منفصلة تحتوي على:
- المستخدمين
- السيارات
- الشركات
- المعاملات
- المحافظ
- سجل التغييرات

### Middleware

- `tenant`: لتحديد المستأجر الحالي
- `central`: للوصول للوحة التحكم المركزية

### Routes

- **Central Routes**: `/admin/*` - إدارة المستأجرين
- **Tenant Routes**: جميع المسارات الأخرى - تطبيق المستأجر

## الأمان

- عزل كامل للبيانات بين المستأجرين
- منع الوصول غير المصرح به
- تشفير البيانات الحساسة
- التحقق من صحة الاشتراكات

## التطوير

### إضافة جدول جديد للمستأجرين

1. أنشئ Migration في مجلد `database/migrations/tenant/`
2. أضف العلاقة مع `tenant_id` في النموذج
3. أضف العلاقة مع Tenant في النموذج

### إضافة ميزة جديدة

1. أضف Controller method
2. أضف Route في المجموعة المناسبة
3. أضف View إذا لزم الأمر

## الدعم

للحصول على الدعم، يرجى التواصل مع فريق التطوير.

## الترخيص

هذا المشروع مرخص تحت رخصة MIT.
